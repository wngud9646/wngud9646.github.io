---
title:  "쿠버네티스 모니터링"
excerpt: "DevOps 부트캠프 Section 4"

categories:
  - Blog
tags:
  - [Blog, DevOps]

toc: true
toc_sticky: true
 
date: 2023-06-02
last_modified_at: 2023-06-02
---
# 쿠버네티스 모니터링


## 질문
### 모니터링 시스템에는 메트릭 수집을 위한 두 가지 방식의 메커니즘이 존재합니다. 바로 Pull 방식과 Push 방식입니다. 프로메테우스는 어떤 방식의 메커니즘을 사용하나요? 또한 Pull 방식과 Push 방식은 어떻게 다르며, 장단점은 무엇인지, 또한 해당 방식을 사용하는 모니터링 도구는 어떤 것들이 있는지 연구해 보세요.

Pull 방식: 메트릭을 수집하고자 하는 측에서 주기적으로 데이터를 가져온다. 
메트릭을 요청하고 수집하는 주체는 메트릭 수집기인 프로메테우스 서버이다. 

Push 방식: 데이터 소스에서 주기적으로 메트릭을 전송한다. 
메트릭을 전송하는 주체는 애플리케이션 또는 에이전트입니다. 
Push 방식은 데이터 소스의 변경 사항을 즉시 수집하고 모니터링하는 데 사용됩니다.


Pull 방식의 장점:

필요한 메트릭만 가져오기 때문에 리소스를 효율적으로 사용할 수 있다.
수집 대상의 상태를 주기적으로 모니터링할 수 있다.
프로메테우스 서버의 관리가 상대적으로 쉽다.

Pull 방식의 단점:
실시간 모니터링이 어렵다.
수집 대상의 상태를 모니터링하기 위해 주기적으로 데이터를 가져와야 하므로 데이터의 지연이 발생할 수 있다.

Push 방식의 장점:
실시간으로 데이터를 수집하여 실시간 모니터링이 가능하다.
데이터 소스에서 직접 메트릭을 전송하므로 데이터의 지연이 없다.

Push 방식의 단점:
데이터 소스에서 주기적으로 메트릭을 전송해야 하므로 데이터 소스의 추가 작업이 필요하다.
모든 데이터 소스가 메트릭을 전송하는 데에도 리소스를 소비하게 된다
.
Pull 방식을 사용하는 모니터링 도구로는 프로메테우스가 있으며, Push 방식을 사용하는 도구로는 InfluxDB, Telegraf, Graphite 등이 있습니다.


### 어떤 조직의 SLO가 다음과 같습니다. "GET 호출의 99%는 10ms 이내에 수행되어야 한다" 그렇다면, 이러한 SLO를 달성하려면 어떤 메트릭을 수집하고 어떻게 계산해야 할까요? (척도는 표준화된 범용 지표를 사용합니다)

SLO를 달성하기 위해 적절한 메트릭을 수집하고 계산해야 한다. 일반적으로 다음과 같은 메트릭을 사용하여 SLO를 계산할 수 있다:

- 응답 시간(RTT, Round Trip Time): GET 호출의 응답 시간을 측정하는 메트릭이다.
이는 클라이언트가 요청을 보낸 후 서버로부터 응답을 받을 때까지 걸리는 시간을 측정한다.

- 백분위(Percentiles): 주어진 시간 범위 내에서 응답 시간의 특정 백분위 값을 계산한다. 
예를 들어, 99백분위(99th percentile)는 모든 응답 시간 중 상위 1%의 값을 의미한다.

SLO를 달성하기 위해 다음과 같은 절차를 수행할 수 있다:

1. 응답 시간(RTT) 메트릭을 수집한다. 
이를 위해 프로메테우스와 같은 모니터링 시스템을 사용하여 GET 호출의 응답 시간을 측정하고 수집한다.

2. 수집된 응답 시간 메트릭을 기반으로 백분위를 계산한다. 프로메테우스는 기본적으로 50, 90, 95, 99백분위를 제공한다. 여기서는 99백분위를 사용한다.

3. SLO에 정의된 조건인 "GET 호출의 99%는 10ms 이내에 수행되어야 한다"를 충족하기 위해 99백분위 값을 확인한다.

4. 계산된 99백분위 값이 10ms 이내에 있는지 확인한다. 
이를 통해 SLO를 충족하는지 여부를 판단할 수 있다.

5. 만약 계산된 99백분위 값이 10ms 이내에 있다면 SLO를 달성한 것으로 간주할 수 있다. 
그렇지 않다면 응답 시간을 개선하기 위해 성능 튜닝이나 인프라 조정 등의 조치를 취해야 할 수 있다.

따라서, 응답 시간 메트릭을 수집하고 99백분위 값을 계산하여 SLO를 달성할 수 있는지 확인하는 것이 중요하다.
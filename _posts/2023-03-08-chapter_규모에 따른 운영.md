---
title:  "DevOps"
excerpt: "DevOps 부트캠프 Section 1 "

categories:
  - Blog
tags:
  - [Blog, DevOps]

toc: true
toc_sticky: true
 
date: 2023-03-07
last_modified_at: 2023-03-07
---


# **한 대의 서버**
한 대의 서버가 어떻게 작동하고, 그 서비스에 접속할 수 있을까?

## 사용자 관점
사용자 관점에서는 URL을 웹 브라우저에 입력하면 접속이 가능하다. <br>
* 웹 브라우저란 쉽게 말해 인터넷에 접속하기 위한 소프트웨어

보이지 않는 작업들이 있지만 (GET 통신과 같은) <br>이러한 작업을 간략한 과정으로 요약하면<br>
1. URL, 그 중에서도 www.###.com 부분인 도메인 이름을 IP 주소로 변환 <br>
a. 이것은 서버가 하는 일이 아니다. <br>
b. 보통 인터넷 서비스 제공자에서 DNS 서비스를 제공한다.
* 도메인 이름 시스템(DNS)은 사람이 읽을 수 있는 도메인 이름(예: www.amazon.com)을 머신이 읽을 수 있는 IP 주소(예: 192.0.2.44)로 변환합니다.
2. IP 주소는 인터넷 상에 존재하는 웹 서버에 할당된 유일한 주소이므로, 서비스에 접속 가능하다.

## 서버 관점
앞선 과정에서 사용자가 서버에 도달한다면, 그 후의 작업은 서버의 몫이다. <br>
작업을 간단히 정리한다면 <br>
1. 경로 처리를 한다. 경로란 URL에서 도메인 이름 이후에 등장하는 문자열을 이야기한다. 웹 서버가 정해놓은 규칙(라우팅)에 따라 서버 내의 자원을 사용자에게 제공한다.
2. 서버 내의 자원은 파일이 될 수도 있고 (파일 다운로드), 브라우저에서 해석 가능한 형태의 자원을 지칭할 수도 있다. 보통은 HTML 페이지, 또는 다른 애플리케이션에서 응용할 수 있는 JSON과 같은 응답을 제공한다.

### URL이란?
URL은 Uniform Resource Locator 로 인터넷 상에서 자원(파일)이 위치하는 곳이 어디인지 알려주는 표기법입니다. 우리가 흔히 인터넷 주소라 이야기 하는 것이 URL이라 생각하시면 됩니다.<br><br>

그렇다면 이러한 한 대의 서버에서 클라이언트와의 통신은 어렵지 않다.<br>
하지만 여러 사례를 통하여 서버는 확장할 필요성을 느낄 수 있다.<br>
1. 자원을 여러 곳에 분리시켜 놓고, 이를 종합해서 한 페이지로 보여줄 경우
2. 동시에 수천명이 한 대의 서버에 접속해서 HTML 페이지를 요구할 경우
3. 서비스를 제공하는 단일 서버가 인프라 문제로 갑작스럽게 서비스를 제공할 수 없는 경우
4. 머신 러닝과 같은 여러 대의 컴퓨팅 자원을 통해 만들어진 결과를 한 페이지로 정리해야 할 때

1번 같은 경우는 목적에 따라 서버가 분리되어 있는 경우인데, 전통적인 IT 방식에서 이러한 방식은 목적에 따라 자원을 분리하여, 단일 서버에서 생기는 문제를 단순화 시켰다.

예시로써 내 책상을 설명해본다면, <br>
내 책상 위에는 여러 가지 물건들이 아무렇게나 어질러져있다. 이 물건들 속에서 원하는 물건 찾기는 어려울 것이다. <br>
하지만 작은 서랍을 두고, 용도에 따라 서랍안에 분리해서 넣어놓는다면 원하는 물건을 찾기 훨씬 쉬울것이다. <br>
이런 식으로 용도와 목적에 따라 분리하여 유지보수 등이 쉽고 관리가 용이하다.

2, 3번 같은 경우는 한 대의 서버로는 부족하다. <br>
2번의 경우 한 대의 서버가 트래픽을 감당하지 못할 것이고, 3번의 경우 고장난 서버를 대신할 대체 서버가 있어야 하기 때문이다. <br>

4번의 경우는 머신 러닝을 하기 위한 컴퓨터들은 규모 확장을 해야할 것이다.<br>(머신 러닝은 컴퓨터의 연산능력을 매우 많이 요구한다.)<br>
또한 이러한 컴퓨터들과는 별개로 사용자에게서 오는 요청/응답을 처리하는 컴퓨터가 별도로 있어야할 것이다. <br>
일하는 컴퓨터와 요청/응답을 처리하는 컴퓨터가 따로 있는 형태, 즉 **서버 확장과 목적에 따른 서버 구성이 함께 도입된 일종의 분산 시스템** 이다.
실제로 DevOps 엔지니어들이 구성해야하는 인프라의 대부분은 이와 같은 사례이다.

## 수직 확장 vs 수평 확장
규모 확장에는 크게 두 가지 방법이 있다.
수직 확장(Vertical Scaling, Scale Up)과 수평 확장(Horizontal Scaling, Scale Out)이다.

![alt text](/images/scale.png) ![alt text](/images/scale1.png)
##### 수직 확장(위) / 수평 확장(아래) <br>
#### 이미지 출처: https://broccoli45.tistory.com/45 <br><br>

**수직 확장** 은 그림의 윗부분과 같이 같은 프레임 내에 하드웨어의 성능을 향상시킨 것이다. <br>
즉, 데스크탑의 CPU, 램(RAM), 하드디스크(SSD, HDD), 파워 등을 더 좋은 것으로 교체하는 것이다.<br><br>
**수평 확장** 은 그림의 아랫부분과 같이 새로운 디바이스를 서로 연결시키면서 추가하는 것이다.<br>
결국 분산시켜서 처리하는 형태이다.

서버로 유입되는 트래픽이 적다면, 수직 확장이 좋은 선택이지만, 수직 확장에는 한계가 있다.

1. 트래픽이 많은 경우, 수직 확장을 한 한대의 서버가 감당하기 힘들다.
2. 수직 확장은 장애 대응이 힘들다. <br>
수직 확장을 통해 고성능 서버가 서비스를 제공해도, 이것이 유일한 서버라면 장애 발생시 서비스가 중단된다.

결국 대규모 애플리케이션을 운영하기 위해서는 수평 확장을 고려해야한다. 

[출처](https://broccoli45.tistory.com/45): https://broccoli45.tistory.com/45
<br><br>


## 분산 시스템
분산 시스템은 공유하는 공동의 목표를 달성하기 위해 여러 개의 개별 컴퓨팅 노드에서 컴퓨팅 리소스를 활용하는 컴퓨터 프로그램의 모음입니다.<br>
* 노드(node)는 일반적으로 별도의 물리적 하드웨어 장치를 나타내지만 별도의 소프트웨어 프로세스 또는 기타 반복적인 캡슐화 시스템을 나타낼 수도 있습니다.

분산 시스템은 시스템에서 병목 현상이나 중앙에 장애 지점을 제거하는 것을 목표로 합니다.

### 분산 시스템의 특징
+ 리소스 공유 - 분산 시스템은 하드웨어, 소프트웨어 또는 데이터를 공유할 수 있다.
+ 동시 처리 - 여러 시스템에서 동일한 기능을 동시에 처리할 수 있다.
+ 확장성 - 컴퓨팅 및 처리 용량은 추가 시스템으로 확장할 때 필요에 따라 확장할 수 있다.
+ 오류 감지 - 장애를 더 쉽게 감지할 수 있다.
+ 투명성 - 노드는 시스템의 다른 노드에 액세스하고 통신할 수 있다.

### 용어 정리
* 성능 (Performance): 높은 처리량(throughput) 뿐 아니라 낮은 대기 시간(latency)과 같은 지표 등을 포함하는 개념입니다.
* 확장성 (Scalability): 증가하는 작업량을 처리할 수 있는가, 이로 인한 시스템 확장이 가능한가를 따져보는 기준입니다.
* 중복성 : 높은 가용성을 위해 컴퓨터의 클론을 만드는 것은, 데이터 역시 복제되어야한다는 것이다. 
* 가용성 (Availability): 시스템이 정상적으로 사용 가능한 정도를 의미합니다. <br>
    Availiability = Uptime / (Uptime + Downtime) <br>
* 업타임: 작동중인 시간
* 다운타임: 작동중이지 않은 시간


### 분산 시스템의 장점, 단점 및 위험
* 중앙 집중식 장애 지점과 병목 현상을 제거하여 안정성이 향상된다. - 성능 향상<br>
* 분산 시스템의 노드는 중복성을 제공하므로 노드 장애가 발생할 경우 장애를 처리하고 교체하도록 다른 노드가 준비되어 있다. - 가용성, 중복성<br>
* 노드를 수평적으로 및 수직적으로 손쉽게 확장할 수 있으므로 성능이 향상된다. - 성능 향상, 확장성 <br>
시스템에 과도한 부하가 걸리면 노드를 추가하여 부하를 처리할 수 있다. - 확장성 <br>
* 광범위한 부하를 처리하도록 개별 노드의 용량을 늘릴 수도 있다. - 확장성<br><br>

이러한 장점에 대해서 
* 시스템이 지나치게 복잡하고 유지가 어려워지는 "무분별한 확장"이 발생할 수 있다.
* 시스템이 복잡해짐에 따라 이러한 시스템을 효과적으로 구성, 관리 및 개선하는 데 어려움을 겪을 수 있습니다. 


## 자동화
 새로운 애플리케이션 및 서비스를 개발하고 지속적으로 테스트하며 배포하려면 IT 리소스가 필요하다. <br>
 수작업 위주의 IT 운영 방식은 리소스 투입이 지연되고 서비스 제공 파이프라인이 복잡해질 수 있다. <br>
 그로 인해 기술 검증(PoC) 수행에 지장이 생겨 결국 개발 속도가 느려질 수밖에 없기 때문입니다. <br>
 IT 팀은 애플리케이션 프로그래밍 인터페이스(API) 중심의 설계와 자동화를 결합하여 더 신속하게 리소스를 제공하는 한편 빠른 기술 검증(PoC), 개발, 테스트(Jenkins와 같은 테스트 자동화 오픈소스 프로젝트 활용), 배포를 지원할 수 있습니다.

 [출처](https://www.redhat.com/ko/topics/automation/what-is-devops-automation): https://www.redhat.com/ko/topics/automation/what-is-devops-automation


 ## IT 인프라의 자동화 툴
프라 관리를 자동화할 수 있도록 해주는 기술인 IaC(Infrastructure as Code).

### IaC 코드 작성 방식
IaC를 구동하기 위해선 코드 작성 방식을 선택해야 한다. 방식은 2가지로, 최종 결과물을 구성하는 선언형 접근 방식(Declarative)과 순차적인 명령을 주는 명령형 접근 방식(Imperative)으로 나뉜다. <br>
![alt text](/images/Iac.jpg)<br>
##### 명령형 방식(좌측)과 선언형 방식<br><br>

* 선언형 접근 방식은 필요한 리소스와 리소스 속성을 포함해 ‘원하는 시스템 상태’를 먼저 정의한다. 이 경우 IaC 툴이 사용자가 지정한 인프라 환경을 자동으로 구현한다.<br><br>
* 명령형 접근 방식은 선언형 접근 방식과 다르게 원하는 설정에 필요한 특정 명령을 정확한 순서로 정의해야 한다. <br>
가령, 애플리케이션을 구동하기 위한 클라우드 서비스는 AWS로, 스토리지는 AWS S3로, 쿠버네티스 엔진은 AWS EKS로 지정하는 등 반드시 그 순서를 지키며 명령어를 작성해야 한다.
<br><br>
IaC 툴은 셰프(CHEF), 퍼펫(puppet), 솔트스택(SALTSTACK), 클라우드포메이션(Cloudformation), 앤서블(Ansible), 테라폼(Terraform) 등이 있고, 그 중 오픈소스인 "Ansible"이 떠오르고 있으며, "Terraform"도 혼용되어 사용된다.<br><br>


## 프로비저닝
프로비저닝은 IT 인프라를 설정하는 프로세스입니다. 또한 사용자와 시스템에서 사용할 수 있도록, 데이터와 리소스에 대한 액세스를 관리하는 데 필요한 단계를 지칭하기도 한다.<br>
프로비저닝과 설정은 각기 다른 작업이지만, 둘 다 배포 프로세스의 단계에 포함되며 일단 프로비저닝이 완료되어야 설정 단계를 진행할 수 있다. <br>
프로비저닝에는 서버 프로비저닝, 네트워크 프로비저닝, 사용자 프로비저닝, 서비스 프로비저닝 등 다양한 유형이 있다.<br>

나만의 언어로 말한다면, 깡통 컴퓨터에 서버로써 구동할 수 있도록 MariaDB나 리눅스 같은 운영체제, 프로그램들을 깔아서 설정해 놓는것? 여기서 다른 네트워크가 있다면 연결하고 즉, 필요시에 바로 쓸수있도록 설정들을 다 해놓는 것이라고 생각할 수 있다.

* 서버 프로비저닝: 필요한 리소스를 기반으로 네트워크에서 사용될 서버를 설정하는 프로세스이다. <br>
새로운 시스템을 생성한 후 가동 상태로 만드는 데 필요한 모든 작업은 물론, 해당 시스템에 대해 원하는 상태를 정의하는 작업도 포함된다. <br>
서버 프로비저닝은 데이터센터에 물리적 하드웨어 설치, 소프트웨어 설치 및 설정, 운영 체제 및 애플리케이션 포함, 미들웨어와 네트워크 및 스토리지 연결로 구성된다. <br><br>

* 사용자 프로비저닝이란 액세스 권한과 인증 권한을 모니터링하는 Identity 관리 유형을 뜻합니다. 프로비저닝은 직원, 공급업체, 계약자와 같은 사용자 오브젝트와 사용자 속성을 통해 정의된다. <br>
제공되는 서비스에는 이메일, 데이터베이스 액세스, 네트워크 액세스가 포함될 수 있다. <br>
롤 기반 액세스 제어(Role-Based Access Control, RBAC) 설정은 사용자 프로비저닝의 예이다. 일반적으로 RBAC는 권한, 롤, 그룹, 사용자로 구성된다.<br>
사용자는 하나 이상의 그룹에 할당되고, 그룹에는 롤(예: 읽기 전용, 편집, 관리자)이 할당되며, 롤은 권한으로 구성되는 방식이다.<br>
사용자 프로비저닝은 IT와 HR 사이에서 관리되는 경우가 많다. <br>
_사용자 프로비저닝은 사용자의 권한 관리라고 생각할 수 있겠다. 권한 부여, 제거, 액세스 권한 부여 등등_<br><br>

* 네트워크 프로비저닝은 특히 사용자, 서버, 컨테이너, IoT 기기가 액세스할 네트워크를 설정하는 작업으로 구성될 수 있다. 현대 사회와 같이 다양한 사물이 연결된 세계에는 다양한 유형의 항목이 네트워크 소비자가 될 수 있다. <br>
네트워크 프로비저닝이란 필요한 장비와 배선을 비롯해 사용자에게 통신 서비스를 제공하는 것을 지칭하는 방식을 뜻하며, 흔히 통신 업계에서 사용되며, 사용자를 위한 무선 환경의 서비스 활성화를 포함할 수 있다. <br><br>

* 서비스 프로비저닝이란 서비스 설정과 이와 관련된 데이터 관리를 포함하는 프로비저닝을 뜻합니다. 서비스 프로비저닝은 통신 업계에서 고객을 위한 서비스나 클라우드 인프라를 설정하는 데 사용됩니다. <br>
예를 들어, 클라우드 서비스 프로비저닝은 클라우드 컴퓨팅의 셀프 서비스 구성 요소입니다. 사용자는 IT 직원의 도움 없이도 셀프 서비스 포털을 통해 클라우드 서비스를 사용할 수 있다.<br><br><br>

## 모니터링과 로그
Operate, CI/CD 파이프라인의 마지막 stage이다.
서비스의 현황 파악과 문제 모니터링하는 과정이라고 할 수 있다.
과연 여기에서 어떤 지표를 모니터링하고, 메트릭을 기준으로 삼아야할까.

* 메트릭은 시간에 따라 측정한 결과값이다. 
보다 넓은 의미로는 비즈니스 개념을 나타내는 수치 측정을 의미하기도 한다. <br>
메트릭은 데이터베이스에 저장된 데이터에 대해 수행되는 계산으로, 그 결과가 리포트에 표시되는 것이다.<br> 메트릭은 스프레드시트 소프트웨어의 수식과 비슷하다.<br>
Azure에서는 메트릭으로 캐시 사용률, 캐시 사용률 팩터, CPU, 연결 유지, 총 익스텐트 수 등등을 추적한다.<br>



### 모니터링의 목표
모니터링은 애플리케이션의 성능 및 사용 패턴에 대한 정보를 제공하므로 문제를 식별, 완화 또는 해결할 수 있다.

1. 시간 측면에서 측정되는 주요 메트릭을 최소화하여 고가용성을 달성하는 것이다.
* TTD(감지 시간): 성능 또는 기타 문제가 발생하면 문제에 대한 풍부한 진단 데이터가 자동화된 모니터링을 통해 개발 팀에 다시 공급된다.
* TTM(완화 시간): DevOps 팀은 사용자가 더 이상 영향을 받지 않도록 가능한 한 빨리 문제를 완화하기 위해 정보를 사용한다.
* TTR(수정 시간): 해결 시간을 측정하고 팀이 시간이 지남에 따라 개선하기 위해 노력한다. 완화 후 팀은 문제가 재발하지 않도록 근본 원인에서 문제를 해결하는 방법을 고민한다.

2. 사용량을 추적하여 Validated learning 을 사용하도록 설정하는 것이다.<br>
Validated learning의 핵심 개념은 모든 배포가 **배포로 이어진 가설을 지원하거나 줄이는 실험적 결과를 추적할 수 있는 기회** 라는 것이다. <br>
버전 간의 사용량 및 차이점을 추적하면 팀이 변경의 영향을 측정하고 비즈니스 의사 결정을 내릴 수 있다. 가설이 줄어들면 팀이 빠르게 실패 하거나 피벗할 수 있다. <br>
가설이 지원되면 팀은 두 배로 줄이거나 인내할 수 있다. 이러한 데이터 정보에 입각한 결정은 백로그의 새로운 가설과 우선 순위를 지정한다. <br>
새로운 가설 예시: 모니터링 결과 트래픽이 특정 부분에 몰리니, 해당 부분 트래픽 개선이 필요 => <br>
다음 배포에 해당 가설을 적용하여 배포 => 배포 후 모니터링으로 해당 가설 검증

[출처](https://learn.microsoft.com/en-us/devops/operate/what-is-monitoring): 
https://learn.microsoft.com/en-us/devops/operate/what-is-monitoring